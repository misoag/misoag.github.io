<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../css/style.css" type="text/css" media="screen">
</head>
<body>
    <div class="entry"> 
 <p>从自定义指标中不能调用OrderSend()、OrderClose()、OrderCloseBy()、OrderDelete()和OrderModify()交易函数。</p> 
 <p>本组交易函数应用于智能交易和脚本中。只有智能交易设置中的“允许实时交易”属性被选中，才能调用交易函数。</p> 
 <p>为了在智能交易和脚本中进行交易，在程序交易环境(智能交易和脚本的自动交易的环境)中，只能为它提供一个线程。这就是为什么，如果这个交易环境被一个智能交易操作占用，因此会出现146错误(ERR_TRADE_CONTEXT_BUSY)，其他智能交易或脚本在此时就不能调用成功。为了能确定是否有交易在进行，可使用 IsTradeAllowed() 函数检测。为了清除交易环境下访问共享，我们能够使用个基于全局变量的交易信号，其值可以使用 GlobalVariableSetOnCondition() 函数改变。</p> 
 <p><a href="414.html">MQL4交易函数常见错误代码及处理意见</a></p> 
 <ul> 
  <li><strong><a href="412.html#OrderSelect">OrderSelect()</a></strong> – 选择订单 </li> 
  <li><strong><a href="412.html#OrderClose">OrderClose()</a></strong> – 平仓 </li> 
  <li><strong><a href="412.html#OrderCloseBy">OrderCloseBy()</a></strong> – 相反头寸平仓 </li> 
  <li><strong><a href="412.html#OrderClosePrice">OrderClosePrice()</a></strong> – 获取订单平仓价格 </li> 
  <li><strong><a href="412.html#OrderCloseTime">OrderCloseTime()</a></strong> – 获取订单平仓时间 </li> 
  <li><strong><a href="412.html#OrderComment">OrderComment()</a></strong> – 获取订单注释 </li> 
  <li><strong><a href="412.html#OrderCommission">OrderCommission()</a></strong> – 获取订单佣金数额 </li> 
  <li><strong><a href="412.html#OrderDelete">OrderDelete()</a></strong> – 删除挂单 </li> 
  <li><strong><a href="412.html#OrderExpiration">OrderExpiration()</a></strong> – 获取挂单有效时间 </li> 
  <li><strong><a href="412.html#OrderLots">OrderLots()</a></strong> – 获取订单交易手数 </li> 
  <li><strong><a href="412.html#OrderMagicNumber">OrderMagicNumber()</a></strong> – 获取订单魔术编号 </li> 
  <li><strong><a href="412.html#OrderModify">OrderModify()</a></strong> – 修改订单 </li> 
  <li><strong><a href="#OrderOpenPrice">OrderOpenPrice()</a></strong> – 获取订单开仓价格 </li> 
  <li><strong><a href="#OrderOpenTime">OrderOpenTime()</a></strong> – 获取订单开仓时间 </li> 
  <li><strong><a href="#OrderPrint">OrderPrint()</a></strong> – 打印订单信息 </li> 
  <li><strong><a href="#OrderProfit">OrderProfit()</a></strong> – 获取订单盈利金额 </li> 
  <li><strong><a href="#OrderSend">OrderSend()</a></strong> – 发出订单 </li> 
  <li><strong><a href="#OrdersHistoryTotal">OrdersHistoryTotal()</a></strong> – 获取历史订单总数 </li> 
  <li><strong><a href="#OrderStopLoss">OrderStopLoss()</a></strong> – 获取订单止损值 </li> 
  <li><strong><a href="#OrdersTotal">OrdersTotal()</a></strong> – 获取订单总数 </li> 
  <li><strong><a href="#OrderSwap">OrderSwap()</a></strong> – 获取订单掉期值 </li> 
  <li><strong><a href="#OrderSymbol">OrderSymbol()</a></strong> – 获取订单交易品种 </li> 
  <li><strong><a href="#OrderTakeProfit">OrderTakeProfit()</a></strong> – 获取订单止盈值 </li> 
  <li><strong><a href="#OrderTicket">OrderTicket()</a></strong> – 获取订单的订单编号 </li> 
  <li><strong><a href="#OrderType">OrderType()</a></strong> – 获取订单交易类型 </li> 
 </ul> 
 <p>&nbsp;</p> 
 <h2><a name="OrderOpenPrice"></a>OrderOpenPrice() – 获取订单开仓价格</h2> 
 <pre class="brush: mql4; toolbar: false;">double OrderOpenPrice()</pre> 
 <p>返回当前订单的开仓价格。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(10, SELECT_BY_POS)==true)
    Print("对于定单10的开仓价格",OrderOpenPrice());
  else
    Print("OrderSelect返回错误",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderModify"></a></h2> 
 <h2><a name="OrderOpenTime"></a>OrderOpenTime() – 获取订单开仓时间</h2> 
 <pre class="brush: mql4; toolbar: false;">datetime OrderOpenTime()</pre> 
 <p>返回当前订单的开仓时间。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(10, SELECT_BY_POS)==true)
    Print("定单10 开仓时间",OrderOpenTime());
  else
    Print("OrderSelect 返回的错误 ",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderPrint"></a>OrderPrint() – 打印订单信息</h2> 
 <pre class="brush: mql4; toolbar: false;">void OrderPrint()</pre> 
 <p>按以下格式打印日志中当前定单信息：</p> 
 <p>定单编号; 买入时间; 交易业务; 手数总数; 开仓价格; 止损价格; 止盈价格; 平仓时间; 平仓价格; 佣金; 掉期; 盈利; 注释; 魔术编码; 挂单有效日期</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(10, SELECT_BY_TICKET)==true)
    OrderPrint();
  else
   Print("OrderSelect 失败错误代码是",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderProfit"></a>OrderProfit() – 获取订单盈利金额</h2> 
 <pre class="brush: mql4; toolbar: false;">double OrderProfit()</pre> 
 <p>返回当前订单的盈利金额(除掉期和佣金外)。对于开仓订单当前为浮动盈利。对于已平仓订单为固定盈利。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(10, SELECT_BY_POS)==true)
    Print("定单 10 盈利",OrderProfit());
  else
    Print("OrderSelect返回的错误",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderSend"></a>OrderSend() – 发出订单</h2> 
 <pre class="brush: mql4; toolbar: false;">int OrderSend(string symbol, int cmd, double volume,
              double price, int slippage, double stoploss,
              double takeprofit, void comment, void magic,
              void expiration, void arrow_color)</pre> 
 <p>主要功能用于开仓头寸和挂单交易。</p> 
 <p>如果成功，由交易服务器返回定单的定单编号，如果失败，返回-1。想要获得额外的错误信息，请调用 <a href="386.html#GetLastError">GetLastError()</a> 函数。</p> 
 <p>注：市价定单开始交易时(OP_SELL或OP_BUY)，只有最新卖价或买价可以当作开仓价来用。如果执行与当前货币对不同的交易，必须使用带有MODE_BID或MODE_ASK参数的<a href="388.html#MarketInfo">Marketlnfo()</a> 函数获得要买的货币对最新的报价。预测或是不标准的价格不可用。</p> 
 <p>如果在市场的报价中没有所要的开仓价或者没有按照小数点后位数的要求标准化，将会导致129错误(ERR_INVALID_PRICE)。如果要求的开仓价日期已经过期，将会导致138错误(ERR_REQUOTE)。如果请求的价格过期了，但是还处于市价里，就以现价或仍在price+-slippage(现价+-滑点)范围内现价开仓。</p> 
 <p>止损价和止盈价不能太靠近市价。最小的止损点数可以使用带MODE_STOPLEVEL参数的 <a href="388.html#MarketInfo">MarketInfo()</a> 函数得到。在出错或止损位设置不正确的情况下，将会导致130错误(ERR_INVALID_STOPS)。</p> 
 <p>在发出挂单时，开盘价也不能太靠近市价。挂单价和当前市价之间最小的点数可以使用带MODE_STOPLEVEL参数的 <a href="388.html#MarketInfo">MarketInfo()</a> 函数得到。在挂单开盘价错误的情况下，将会导致130错误(ERR_INVALID_STOPS)。</p> 
 <p>挂单交易的过期时间在一些交易服务器上被禁用。在这种情况下，如果expiration(过期)参数指定了非零值，反而会导致147错误(ERR_TRADE_EXPIRATION_DENIED)产生。</p> 
 <p>在某些交易服务器上，开仓单和挂单的总数有所限制。如果超出限额，就不能再开仓，或者不能再挂单了。如果还开仓或挂单，交易服务器会返回148错误(ERR_TRADE_TOO_MANY_ORDERS)。</p> 
 <p>参数:</p> 
 <pre>symbol      - 交易货币对。
cmd         - 交易类型。可以是 <a href="374.html#Trade_operations">交易类型列举</a> 的任意值。
volume      - 交易手数。
price       - 交易价格。
slippage    - 最大允许滑点数。
stoploss    - 止损价格。
takeprofit  - 止盈价格。
comment     - 注释文本。注释的最后部分可以由服务器修改。
magic       - 订单魔术编号。可以作为用户指定识别码使用。
expiration  - 定单有效时间(只限挂单)。
arrow_color - 图表上箭头颜色。如果参数丢失或使用CLR_NONE价格值将不会在图表中画出。 </pre> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  int ticket;
  if(iRSI(NULL,0,14,PRICE_CLOSE,0)&lt;25)
    {
     ticket=OrderSend(Symbol(),OP_BUY,1,Ask,3,Ask-25*Point,Ask+25*Point,"My order #2",16384,0,Green);
     if(ticket&lt;0)
       {
        Print("OrderSend 失败错误 #",GetLastError());
        return(0);
       }
    }</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrdersHistoryTotal"></a>OrdersHistoryTotal() – 获取历史订单总数</h2> 
 <pre class="brush: mql4; toolbar: false;">int OrdersHistoryTotal()</pre> 
 <p>返回载入到终端账户历史表中已平仓订单数。历史表的范围大小取决于终端”Accounthistory(账户历史)”标签中当前设置。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  // 来自交易历史的订单信息
  int i,hstTotal=OrdersHistoryTotal();
  for(i=0;i&lt;hstTotal;i++)
    {
     //---- 检查选择结果
     if(OrderSelect(i,SELECT_BY_POS,MODE_HISTORY)==false)
       {
        Print("访问历史表失败，错误信息：",GetLastError());
        break;
       }
     // 订单的一些工作</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderStopLoss"></a>OrderStopLoss() – 获取订单止损值</h2> 
 <pre class="brush: mql4; toolbar: false;">double OrderStopLoss()</pre> 
 <p>返回当前订单的止损值。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(ticket,SELECT_BY_POS)==true)
    Print("对于10 止损值", OrderStopLoss());
  else
   Print("OrderSelect 失败错误代码是",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrdersTotal"></a>OrdersTotal() – 获取订单总数</h2> 
 <pre class="brush: mql4; toolbar: false;">int OrdersTotal()</pre> 
 <p>返回市场单和挂单总数。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  int handle=FileOpen("OrdersReport.csv",FILE_WRITE|FILE_CSV,"\t");
  if(handle&lt;0) return(0);
  // 写标题
  FileWrite(handle,"#","开价格","买入时间","货币对","手数");
  int total=OrdersTotal();
  // 编写定单命令
  for(int pos=0;pos&lt;total;pos++)
    {
     if(OrderSelect(pos,SELECT_BY_POS)==false) continue;
     FileWrite(handle,OrderTicket(),OrderOpenPrice(),OrderOpenTime(),OrderSymbol(),OrderLots());
    }
  FileClose(handle);</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderSwap"></a>OrderSwap() – 获取订单掉期值</h2> 
 <pre class="brush: mql4; toolbar: false;">double OrderSwap()</pre> 
 <p>返回当前订单的掉期值。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(order_id, SELECT_BY_TICKET)==true)
    Print("对于定单 #", order_id, "掉期", OrderSwap());
  else
   Print("OrderSelect 失败错误代码是",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderSymbol"></a>OrderSymbol() – 获取订单交易品种</h2> 
 <pre class="brush: mql4; toolbar: false;">string OrderSymbol()</pre> 
 <p>返回当前订单的交易品种名称。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(12, SELECT_BY_POS)==true)
    Print("定单 #", OrderTicket(), " 货币对是", OrderSymbol());
  else
   Print("OrderSelect 失败错误代码是",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderTakeProfit"></a>OrderTakeProfit() – 获取订单止盈值</h2> 
 <pre class="brush: mql4; toolbar: false;">double OrderTakeProfit()</pre> 
 <p>返回当前订单的止盈值。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(12, SELECT_BY_POS)==true)
    Print("定单 #",OrderTicket()," 盈利: ", OrderTakeProfit());
  else
    Print("OrderSelect() 返回错误 - ",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderTicket"></a>OrderTicket() – 获取订单的订单编号</h2> 
 <pre class="brush: mql4; toolbar: false;">int OrderTicket()</pre> 
 <p>返回当前订单的订单编号。</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  if(OrderSelect(12, SELECT_BY_POS)==true)
    order=OrderTicket();
  else
   Print("OrderSelect 失败错误代码",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 
 <h2><a name="OrderType"></a>OrderType() – 获取订单交易类型</h2> 
 <pre class="brush: mql4; toolbar: false;">int OrderType()</pre> 
 <p>返回当前订单的交易类型。可以是 <a href="374.html#Trade_operations">交易类型列表</a> 下的值</p> 
 <p>注：定单必须用 <a href="412.html#OrderSelect">OrderSelect()</a> 函数提前选定。 </p> 
 <p>示例:</p> 
 <pre class="brush: mql4; toolbar: false;">  int order_type;
  if(OrderSelect(12, SELECT_BY_POS)==true)
    {
     order_type=OrderType();
     // ...
    }
  else
    Print("OrderSelect() 返回错误 - ",GetLastError());</pre> 
 <div class="divider top-of-page">
  <a title="Top of Page" href="#top">Back to Top</a>
 </div> 本文地址：
 <a href="413.html" rel="bookmark"><b>413.html</b></a> 
</div>
</body>
</html>