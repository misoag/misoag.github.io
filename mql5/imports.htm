<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta name="keywords" content="online documentation, web online help, web help, chm2web" />
<meta http-equiv="Content-Style-Type" content="text/css" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />

<meta name="generator" content="chm2web Pro 2.85 (unicode)" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta http-equiv="Content-Style-Type" content="text/css">

<title>Call of Imported Functions</title>
<meta name="keywords" content="">
<link rel="stylesheet" href="files/helpindex.css" type="text/css">
<link rel="stylesheet" href="default.css" type="text/css">

<script type="text/JavaScript" src="files/supply.js"></script>
<script type="text/JavaScript">
chmtop.c2wtopf.pageid = "imports.htm";
</script>

</head>
<body style=
"background-color:#FFFFFF; font-family:'Trebuchet MS',Tahoma,Arial,Helvetica,sans-serif; margin:0px;"><script type="text/JavaScript"> 
if (window.name != "content") 
  document.write(" <table width=\"100%\" bgcolor=\"#e1e1e1\"cellspacing=\"2\" cellpadding=\"0\" style=\"border-collapse: collapse; font-family: sans-serif; font-size: 14px; color: #000000; text-decoration: none;  \"> <tr> <td align=\"center\" style=\"border-bottom: 2px solid gray\" > <br>&nbsp;Click <a href=\"index.html?page=imports.htm\">here</a> to show toolbars of the Web Online Help System: <a href=\"index.html?page=imports.htm\">show toolbars</a><br>&nbsp;</td></tr></table><br> "); 
</script>
<!-- !chm2web! -->


<table width="100%" border="0" cellpadding="0" cellspacing="0"
style=
"margin:0; background: #7F90A5 url('gradient_header.png') repeat-x left top; border-bottom: 3px solid #DBE0E5;">
<tr>
<td valign="middle">
<table style="margin: 10px 0" width="100%" border="0" cellspacing=
"0" cellpadding="0">
<tr valign="middle">
<td class="nav"><a class="h_m" href="index.htm">MQL5 Reference</a>
/ <a class="h_m" href="runtime.htm">MQL5 programs</a> / Call of
Imported Functions</td>
<td align="right" style="white-space: nowrap; padding: 0 10px;">
<a href="resources.htm"><img style="vertical-align:middle;" src=
"previous.png" alt="Back" width="27" height="27" border=
"0"></a><a href="errors.htm"><img style=
"vertical-align:middle;margin-left: 7px;" src="next.png" alt=
"Forward" width="27" height="27" border="0"></a>
</td>
</tr>
</table>
</td>
</tr>
</table>

<div id="help">
<p class="p_H1"><span class="f_H1">Call of Imported
Functions</span>
</p>

<p class="p_Text"><span class="f_Text">To import functions during
the execution of a mql5-program, the client terminal uses early
binding. This means that if a program has call of an imported
function, the corresponding module (ex5 or dll) is loaded during
the program load. MQL5 and DLL libraries are executed in the thread
of a calling module.</span>
</p>

<p class="p_Text"><span class="f_Text">It is not recommended to use
the fully specified name of the module to be loaded like</span>
<span class="f_Text" style=
"font-style: italic;">Drive:\Directory\FileName.Ext</span><span class="f_Text">.
The MQL5 libraries are loaded from the</span> <span class="f_Text"
style="font-style: italic;">terminal_dir\MQL5\Libraries</span>
<span class="f_Text">folder. If the library hasn't been found, then
the client terminal performs an attempt to load it from</span>
<span class="f_Text" style=
"font-style: italic;">terminal_dir\experts</span> <span class=
"f_Text">folder.</span></p>

<p class="p_Text"><span class="f_Text">The system libraries (DLL)
&nbsp;are loaded by the operating system rules. If the library is
already loaded (for example, another Expert Advisor, and even from
another client terminal, running in parallel), then it uses
requests to the library already loaded. Otherwise, it performs a
search in the following sequence:</span>
</p>

<ol class="help_list" style=
"text-align: justify; text-indent: 0px; padding: 0px 0px 0px 17px; margin: 3px 17px 3px 17px;">
<li><span class="f_li">Directory, from which the module importing
dll was started. The module here is an Expert Advisor, a script, an
indicator or EX5 library;</span>
</li>

<li><span class="f_li">Directory
terminal_data_directory\MQL5\Libraries (<a href=
"terminalstatus.htm#enum_terminal_info_string" class=
"topiclink">TERMINAL_DATA_PATH</a>\MQL5\Libraries);</span>
</li>

<li><span class="f_li">Directory, from which the MetaTrader 5
client terminal was started;</span>
</li>

<li><span class="f_li">System directory;</span>
</li>

<li><span class="f_li">Windows directory;</span>
</li>

<li><span class="f_li">Current directory;</span>
</li>

<li><span class="f_li">Directories listed in the PATH system
variable.</span>
</li>
</ol>

<p class="p_Text"><span class="f_Text">If the DLL library uses
another DLL in its work, the first one cannot be loaded in case
when there is no second DLL.</span>
</p>

<p class="p_Text"><span class="f_Text">Before an Expert Advisor
(script, indicator) is loaded, a common list of all EX5 library
modules is formed. It's going to be used both from a loaded Expert
Advisor (script, indicator) and from libraries of this list. Thus
the one-time loading of many times used EX5 library modules is
needed. Libraries use <a href="predefined.htm" class=
"topiclink">predefined variables</a> of the Expert Advisor (script,
indicator) they were called by.</span>
</p>

<p class="p_Text"><span class="f_Text">The imported library EX5 is
searched for in the following sequence:</span>
</p>

<ol class="help_list" style=
"text-align: justify; text-indent: 0px; padding: 0px 0px 0px 17px; margin: 3px 17px 3px 17px;">
<li><span class="f_li">Directory, path to which is set relative to
the directory of the Expert Advisor (script, indicator) that
imports EX5</span><span class="f_Text">)</span><span class=
"f_li">;</span>
</li>

<li><span class="f_li">Directory
terminal_directory\MQL5\Libraries;</span>
</li>

<li><span class="f_li">Directory MQL5\Libraries in the common
directory of all MetaTrader 5 client terminals
(Common\MQL5\Libraries).</span>
</li>
</ol>

<p class="p_Text"><span class="f_Text">Functions <a href=
"import.htm" class="topiclink">imported</a> DLL into a mql5-program
must ensure the Windows API calls agreement. To ensure such an
agreement, in the source text of programs written in C or C++, use
the keyword __stdcall, which is specific to the Microsoft(r)
compilers. This agreement is characterized by the following:</span>
</p>

<ul class="help_list" style=
"text-align: justify; text-indent: 0px; padding: 0px 0px 0px 17px; margin: 3px 17px 3px 17px;">
<li><span class="f_li">caller (in our case it is a mq5-program)
should "see" a prototype of a function called (imported from the
DLL), in order to properly combine parameters to a stack;</span>
</li>

<li><span class="f_li">caller (in our case it is a mql5-program)
puts parameters to the stack in a reverse order, from right to left
- in this order an imported function reads parameters passed to
it;</span>
</li>

<li><span class="f_li">parameters are passed by value, except those
explicitly passed by reference (in our case strings)</span>
</li>

<li><span class="f_li">an imported function cleans the stack
independently by reading parameters passed to it.</span>
</li>
</ul>

<p class="p_Text"><span class="f_Text">When describing the
prototype of an imported function, default parameters can be
used.</span>
</p>

<p class="p_Text"><span class="f_Text">If the corresponding library
is unable to load, or there is a prohibition on the DLL use, or the
imported function is not found - the Expert Advisor stops its
operation with the appropriate message "Expert Advisor stopped" in
the Journal (log file). In this case the Expert Advisor will not
run until it is reinitialized. An Expert Advisor can be
reinitialized as a result of recompilation or after the table of
its properties is opened and OK is pressed.</span>
</p>

<p class="p_H2"><span class="f_H2">Passing Parameters</span>
</p>

<p class="p_Text"><span class="f_Text">All parameters of <a href=
"types.htm#base_types" class="topiclink">simple types</a> are
passed by values unless it is explicitly indicated that they are
passed by reference. When a <a href="stringconst.htm" class=
"topiclink">string</a> is passed, the address of the buffer of the
copied string is passed; if a string is passed by reference, the
address of the buffer of this string without copying it is passed
to the function imported from DLL.</span>
</p>

<p class="p_Text"><span class="f_Text"><a href="classes.htm" class=
"topiclink">Structures</a> that contain dynamic arrays, strings,
classes, other complex structures, as well as static or <a href=
"dynamic_array.htm" class="topiclink">dynamic arrays</a> of the
enumerated objects, can't be passed as a parameter to an imported
function.</span>
</p>

<p class="p_Text"><span class="f_Text">When passing an array to
DLL, the address of the beginning of the data buffer is always
passed (irrespective of the <a href="arraygetasseries.htm" class=
"topiclink">AS_SERIES</a> flag). A function inside a DLL knows
nothing about the AS_SERIES flag, the passed array is a static
array of an undefined length; an additional parameter should be
used for specifying the array size.</span>
</p>
<br>
</div>

<script type="text/JavaScript">
var fe = FindFrame("toc", top);
if ((fe != null) && (chmtop.c2wtopf.jstree != null)) {
  if (chmtop.c2wtopf.FITEMS[chmtop.c2wtopf.pagenum] != chmtop.c2wtopf.pageid)
    chmtop.c2wtopf.jstree.OpenTreeNode("" + chmtop.c2wtopf.pageid);
}
</script>

<!-- CHM2WEB -->
<!-- DO NOT DELETE OR MODIFY THIS CODE WITHOUT 
     WRITTEN PERMISSION OF A!K RESEARCH LABS -->
<table width="100%" cellspacing="0" cellpadding="0" 
style="margin-top: 0pt; border-collapse: collapse;"> 
<tr> <td align="right" style="background-color:white; border-top: 1px solid gray;"> 
<a href="http://chm2web.aklabs.com" target="_blank" style="font-family: sans-serif;  font-size: 11px; text-decoration: none;"><font color="gray">Converted from CHM to HTML with <b>chm2web Pro 2.85 (unicode)</b></font></a>
</td></tr></table> 
<!-- /CHM2WEB -->

</body>
</html>
